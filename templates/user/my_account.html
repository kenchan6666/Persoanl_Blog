{% extends "base.html" %}

{% block title %}个人中心{% endblock %}

{% block content %}
<div class="max-w-4xl mx-auto px-6 py-20">
    <h1 class="text-5xl font-mono glow-text text-center mb-12">个人中心</h1>

    <div class="glass rounded-2xl p-10">
        <div class="flex flex-col md:flex-row items-center gap-10">
            <div class="w-40 h-40 rounded-full overflow-hidden border-4 border-primary/50">
                {% if current_user.avatar %}
                    <img src="{{ url_for('static', filename='uploads/avatar/' + current_user.avatar) }}" alt="头像" class="w-full h-full object-cover">
                {% else %}
                    <img src="https://api.dicebear.com/7.x/avataaars/svg?seed={{ current_user.username }}" alt="头像" class="w-full h-full object-cover">
                {% endif %}
            </div>

            <form method="POST" enctype="multipart/form-data">
                <!-- 头像上传 -->
                <div class="mb-6">
                    <label class="block text-text-muted mb-2">上传新头像</label>
                    <input type="file" name="avatar" class="form-control" accept="image/*">
                </div>

                <!-- 管理员专属字段 -->
                {% if current_user.is_admin_user() %}
                <div class="mb-6">
                    <label class="block text-text-muted mb-2">个人简介（支持 Markdown）</label>
                    <textarea name="bio" rows="6" class="form-control">{{ current_user.bio }}</textarea>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                    <div>
                        <label class="block text-text-muted mb-2">GitHub</label>
                        <input type="url" name="github" class="form-control" value="{{ current_user.github }}">
                    </div>
                    <div>
                        <label class="block text-text-muted mb-2">Twitter</label>
                        <input type="url" name="twitter" class="form-control" value="{{ current_user.twitter }}">
                    </div>
                </div>
                {% endif %}

                <button type="submit" class="px-8 py-4 bg-primary/20 border-2 border-primary rounded-xl hover:bg-primary/40 transition text-xl">
                    保存设置
                </button>
            </form>

            <div class="flex-1 text-center md:text-left">
                <h2 class="text-3xl font-mono mb-4">{{ current_user.username }}</h2>
                <p class="text-xl text-text-muted mb-6">{{ current_user.email }}</p>
                <p class="text-lg leading-relaxed mb-8">
                    {% if current_user.bio %}
                        {{ current_user.bio|safe }}
                    {% else %}
                        这个家伙很懒，什么都没写。
                    {% endif %}
                </p>
                <div class="flex justify-center md:justify-start gap-6 text-2xl">
                    {% if current_user.github %}
                        <a href="{{ current_user.github }}" target="_blank" class="hover:text-primary-glow transition">
                            <i class="bi bi-github"></i>
                        </a>
                    {% endif %}
                    {% if current_user.twitter %}
                        <a href="{{ current_user.twitter }}" target="_blank" class="hover:text-primary-glow transition">
                            <i class="bi bi-twitter"></i>
                        </a>
                    {% endif %}
                </div>
            </div>
        </div>

        <div class="mt-12 grid grid-cols-1 md:grid-cols-3 gap-6">
            <a href="{{ url_for('users.update_password') }}" class="px-8 py-6 glass border border-primary/30 rounded-xl hover:border-primary transition text-center">
                <h3 class="text-xl mb-2">修改密码</h3>
                <p class="text-text-muted text-sm">更新你的账户密码</p>
            </a>
            <a href="{{ url_for('users.update_email') }}" class="px-8 py-6 glass border border-primary/30 rounded-xl hover:border-primary transition text-center">
                <h3 class="text-xl mb-2">修改邮箱</h3>
                <p class="text-text-muted text-sm">更改登录邮箱</p>
            </a>
            <a href="{{ url_for('users.my_favorites') }}" class="px-8 py-6 glass border border-primary/30 rounded-xl hover:border-primary transition text-center">
                <h3 class="text-xl mb-2">我的收藏</h3>
                <p class="text-text-muted text-sm">查看收藏的文章和战绩</p>
            </a>
        </div>

        {% if current_user.is_admin_user() %}
        <div class="mt-12 text-center">
            <a href="{{ url_for('admin.dashboard') }}" class="inline-block px-10 py-5 bg-primary/20 border-2 border-primary rounded-xl hover:bg-primary/40 transition text-2xl font-medium">
                进入管理后台 →
            </a>
        </div>
        {% endif %}
    </div>
</div>
{% endblock %}